{% extends "base.html" %}

{% block content %}
<h1>Articles</h1>
<input type="hidden" id="current-order" value="{{ current_order }}">
<table id="articles-list" class="table table-striped">
    <thead>
        <tr>
            <th class="articles-list-header">
                <a id="article-publication_date" href="{% url 'article-list' %}?order=publication_date">Publication date</a>
            </th>
            <th class="articles-list-header">
                <a id="article-author" href="{% url 'article-list' %}?order=author">Author</a>
            </th>
            <th class="articles-list-header">
                <a id="article-title" href="{% url 'article-list' %}?order=title">Title</a>
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for article in articles %}
            <tr>
                <td>{{ article.publication_date|date }}</td>
                <td>{{ article.author }}</td>
                <td>{{ article.title }}</td>
                <td><a href="{% url 'article-detail' article.pk %}">Read</a></td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="4">No articles yet.</td>
            </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}

{% block scripts %}
    <script type="text/javascript">
        const upArrowEntity = '&uarr;';
        const downArrowEntity = '&darr;';

        $(document).ready(function() {
            let currentOrder = $('input#current-order').val();
            let isDescending = currentOrder.startsWith('-');
            
            let currentOrderColumnName = currentOrder;
            if(isDescending) {
                currentOrderColumnName = currentOrderColumnName.substring(1);
            }

            $('table#articles-list th.articles-list-header').each(function() {
                // Extract column name from the header link's ID.
                let $headerLink = $(this).children('a').eq(0);
                let columnName = $headerLink.attr('id').split('-').at(-1);

                if(columnName == currentOrderColumnName) {
                    let baseUrl = $headerLink.attr('href').split('=').at(0) + '=';
                    if(isDescending) {
                        $headerLink.append(downArrowEntity);
                        $headerLink.attr('href', baseUrl + columnName);
                    } else {
                        $headerLink.append(upArrowEntity);
                        $headerLink.attr('href', baseUrl + '-' + columnName);
                    }
                }
            });
        });
    </script>
{% endblock %}